<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>turn-mode-1</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="turn-based-game--mode-1">turn-based game + mode #1</h1>
<p>Suppose players P1 and P2 have been matched together. This is the moment when match_id is created and match timer begins.</p>
<h2 id="start-match">Start Match</h2>
<p>Player must receive the conditional payment from the opponent before starting the game. If P1 has sent the conditional payment while P2 does not send conditional payment, the game won’t start and the locked payment of P1 will be refunded after maxMatchDuration (which is also the conditional payment timeout).</p>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-x1qjLWrZ06qmMoZi" height="100%" width="100%" style="max-width:450px;" viewBox="-50 -10 450 325"><g></g><g><line id="actor10438" x1="75" y1="5" x2="75" y2="314" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><line id="actor10439" x1="275" y1="5" x2="275" y2="314" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g><defs><marker id="arrowhead" refX="5" refY="2" markerWidth="6" markerHeight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><g><text x="175" y="93" class="messageText" style="text-anchor: middle;">send conditional payment</text><line x1="75" y1="100" x2="275" y2="100" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><text x="175" y="128" class="messageText" style="text-anchor: middle;">send conditional payment</text><line x1="275" y1="135" x2="75" y2="135" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="0" y="145" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-4" y="169" fill="black" class="noteText"><tspan x="16" fill="black">game starts</tspan></text></g><g><rect x="200" y="192" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="196" y="216" fill="black" class="noteText"><tspan x="216" fill="black">game starts</tspan></text></g><g><rect x="0" y="249" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="281.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><rect x="200" y="249" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="281.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g></svg></div>
<h2 id="exchange-game-state">Exchange Game State</h2>
<h3 id="cooperative-case">Cooperative Case</h3>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-bac3CvH8vOlyPTe4" height="100%" width="100%" style="max-width:550px;" viewBox="-150 -10 550 530"><g></g><g><line id="actor10440" x1="75" y1="5" x2="75" y2="519" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><line id="actor10441" x1="275" y1="5" x2="275" y2="519" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g><defs><marker id="arrowhead" refX="5" refY="2" markerWidth="6" markerHeight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><g><rect x="-100" y="75" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="-104" y="99" fill="black" class="noteText"><tspan x="-84" fill="black">Suppose P1 makes </tspan></text><text x="-104" y="116" fill="black" class="noteText"><tspan x="-84" fill="black"> a move</tspan></text></g><g><rect x="0" y="139" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-4" y="163" fill="black" class="noteText"><tspan x="16" fill="black">sendState(state)</tspan></text></g><g><text x="175" y="204" class="messageText" style="text-anchor: middle;">state+sig1</text><line x1="75" y1="211" x2="275" y2="211" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="200" y="221" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="196" y="245" fill="black" class="noteText"><tspan x="216" fill="black">onStateReceived()</tspan></text></g><g><rect x="200" y="268" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="196" y="292" fill="black" class="noteText"><tspan x="216" fill="black">state is valid? true</tspan></text></g><g><rect x="200" y="315" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="196" y="339" fill="black" class="noteText"><tspan x="216" fill="black">store co-signed state</tspan></text></g><g><text x="175" y="380" class="messageText" style="text-anchor: middle;">state+sig1+sig2</text><line x1="275" y1="387" x2="75" y2="387" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="0" y="397" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-4" y="421" fill="black" class="noteText"><tspan x="16" fill="black">store co-signed state</tspan></text></g><g><rect x="0" y="454" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="486.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><rect x="200" y="454" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="486.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g></svg></div>
<h3 id="cheating-case">Cheating Case</h3>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-Lp8CO2LVRGSbJoC4" height="100%" width="100%" style="max-width:550px;" viewBox="-150 -10 550 482"><g></g><g><line id="actor10442" x1="75" y1="5" x2="75" y2="471" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><line id="actor10443" x1="275" y1="5" x2="275" y2="471" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g><defs><marker id="arrowhead" refX="5" refY="2" markerWidth="6" markerHeight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><g><rect x="-100" y="75" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="-104" y="99" fill="black" class="noteText"><tspan x="-84" fill="black">Suppose P1 makes </tspan></text><text x="-104" y="116" fill="black" class="noteText"><tspan x="-84" fill="black"> a move</tspan></text></g><g><rect x="0" y="139" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-4" y="163" fill="black" class="noteText"><tspan x="16" fill="black">sendState(state)</tspan></text></g><g><text x="175" y="204" class="messageText" style="text-anchor: middle;">state+sig1</text><line x1="75" y1="211" x2="275" y2="211" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="200" y="221" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="196" y="245" fill="black" class="noteText"><tspan x="216" fill="black">onStateReceived()</tspan></text></g><g><rect x="200" y="268" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="196" y="292" fill="black" class="noteText"><tspan x="216" fill="black">state is valid? false</tspan></text></g><g><rect x="200" y="315" fill="#EDF2AE" stroke="#666" width="150" height="71" rx="0" ry="0" class="note"></rect><text x="196" y="339" fill="black" class="noteText"><tspan x="216" fill="black">do nothing but</tspan></text><text x="196" y="356" fill="black" class="noteText"><tspan x="216" fill="black">recommend developer</tspan></text><text x="196" y="373" fill="black" class="noteText"><tspan x="216" fill="black">to showDisputeUI()</tspan></text></g><g><rect x="0" y="406" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="438.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><rect x="200" y="406" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="438.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g></svg></div>
<h2 id="end-game">End Game</h2>
<h3 id="end-game-normally">End game normally</h3>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-JVNwDQREukl2ABvm" height="100%" width="100%" style="max-width:550px;" viewBox="-150 -10 550 594"><g></g><g><line id="actor10444" x1="75" y1="5" x2="75" y2="583" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><line id="actor10445" x1="275" y1="5" x2="275" y2="583" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g><defs><marker id="arrowhead" refX="5" refY="2" markerWidth="6" markerHeight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><g><rect x="-100" y="75" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-104" y="99" fill="black" class="noteText"><tspan x="-84" fill="black">suppose P1 wins</tspan></text></g><g><rect x="0" y="122" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-4" y="146" fill="black" class="noteText"><tspan x="16" fill="black">declareWinner(P1)</tspan></text></g><g><text x="175" y="187" class="messageText" style="text-anchor: middle;">winner is P1</text><line x1="75" y1="194" x2="275" y2="194" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="200" y="204" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="196" y="228" fill="black" class="noteText"><tspan x="216" fill="black">onWinnerReceived(P1)</tspan></text></g><g><rect x="200" y="251" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="196" y="275" fill="black" class="noteText"><tspan x="216" fill="black">agree winner? true</tspan></text><text x="196" y="292" fill="black" class="noteText"><tspan x="216" fill="black">resolve payment</tspan></text></g><g><rect x="200" y="315" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="196" y="339" fill="black" class="noteText"><tspan x="216" fill="black">declareWinner(P1)</tspan></text></g><g><text x="175" y="380" class="messageText" style="text-anchor: middle;">winner is P1</text><line x1="275" y1="387" x2="75" y2="387" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="0" y="397" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-4" y="421" fill="black" class="noteText"><tspan x="16" fill="black">onWinnerReceived(P1)</tspan></text></g><g><rect x="0" y="444" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="-4" y="468" fill="black" class="noteText"><tspan x="16" fill="black">agree winner? true</tspan></text><text x="-4" y="485" fill="black" class="noteText"><tspan x="16" fill="black">resolve payment</tspan></text></g><g><rect x="0" y="518" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="550.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><rect x="200" y="518" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="550.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g></svg></div>
<h3 id="end-game-with-conflict-winners">End game with conflict winners</h3>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-o3NxK1LV7NshLGVX" height="100%" width="100%" style="max-width:450px;" viewBox="-50 -10 450 547"><g></g><g><line id="actor10446" x1="75" y1="5" x2="75" y2="536" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><line id="actor10447" x1="275" y1="5" x2="275" y2="536" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g><defs><marker id="arrowhead" refX="5" refY="2" markerWidth="6" markerHeight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><g><rect x="0" y="75" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-4" y="99" fill="black" class="noteText"><tspan x="16" fill="black">declareWinner(P1)</tspan></text></g><g><text x="175" y="140" class="messageText" style="text-anchor: middle;">winner is P1</text><line x1="75" y1="147" x2="275" y2="147" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="200" y="157" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="196" y="181" fill="black" class="noteText"><tspan x="216" fill="black">onWinnerReceived(P1)</tspan></text></g><g><rect x="200" y="204" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="196" y="228" fill="black" class="noteText"><tspan x="216" fill="black">agree winner? false </tspan></text><text x="196" y="245" fill="black" class="noteText"><tspan x="216" fill="black">showDisputeUI()</tspan></text></g><g><rect x="200" y="268" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="196" y="292" fill="black" class="noteText"><tspan x="216" fill="black">declareWinner(P2)</tspan></text></g><g><text x="175" y="333" class="messageText" style="text-anchor: middle;">winner is P2</text><line x1="275" y1="340" x2="75" y2="340" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="0" y="350" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-4" y="374" fill="black" class="noteText"><tspan x="16" fill="black">onWinnerReceived(P2)</tspan></text></g><g><rect x="0" y="397" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="-4" y="421" fill="black" class="noteText"><tspan x="16" fill="black">agree winner? false </tspan></text><text x="-4" y="438" fill="black" class="noteText"><tspan x="16" fill="black">showDisputeUI()</tspan></text></g><g><rect x="0" y="471" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="503.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><rect x="200" y="471" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="503.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g></svg></div>
<h2 id="player-actively-aborts-game-surrender">Player actively aborts game (“surrender”)</h2>
<p>If P1 actively aborts the game by clicking the “abort” button, then the winner will be P2 and the payment will be immediately resolved off-chain.</p>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-9LCsC9WEeKrQTuJh" height="100%" width="100%" style="max-width:450px;" viewBox="-50 -10 450 337"><g></g><g><line id="actor10448" x1="75" y1="5" x2="75" y2="326" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><line id="actor10449" x1="275" y1="5" x2="275" y2="326" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g><defs><marker id="arrowhead" refX="5" refY="2" markerWidth="6" markerHeight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><g><rect x="0" y="75" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-4" y="99" fill="black" class="noteText"><tspan x="16" fill="black">actively abort game</tspan></text></g><g><text x="175" y="140" class="messageText" style="text-anchor: middle;">I abort game</text><line x1="75" y1="147" x2="275" y2="147" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"></line></g><g><rect x="200" y="157" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="196" y="181" fill="black" class="noteText"><tspan x="216" fill="black">resolve payment</tspan></text></g><g><rect x="0" y="204" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-4" y="228" fill="black" class="noteText"><tspan x="16" fill="black">resolve payment</tspan></text></g><g><rect x="0" y="261" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="293.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><rect x="200" y="261" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="293.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g></svg></div>
<h2 id="player-turn-timeout">Player Turn Timeout</h2>
<p>During the game, if P2 finds that P1 does not move within his turn timeout, P2 will trigger dispute UI.</p>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-foV25INjTRZJLeOm" height="100%" width="100%" style="max-width:450px;" viewBox="-50 -10 450 255"><g></g><g><line id="actor10450" x1="75" y1="5" x2="75" y2="244" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><line id="actor10451" x1="275" y1="5" x2="275" y2="244" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g><defs><marker id="arrowhead" refX="5" refY="2" markerWidth="6" markerHeight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><g><rect x="0" y="75" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-4" y="99" fill="black" class="noteText"><tspan x="16" fill="black">turn timeout</tspan></text></g><g><rect x="200" y="122" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="196" y="146" fill="black" class="noteText"><tspan x="216" fill="black">showDisputeUI()</tspan></text></g><g><rect x="0" y="179" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="211.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><rect x="200" y="179" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="211.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g></svg></div>
<h2 id="dispute-and-on-chain-play">Dispute and On-chain Play</h2>
<p>Suppose P1 calls “showDisputeUI()” and chooses to enter the court mode. Then the following flow is triggered.</p>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-aacig4SKF6X6NItJ" height="100%" width="100%" style="max-width:450px;" viewBox="-50 -10 450 840"><g></g><g><line id="actor10452" x1="75" y1="5" x2="75" y2="829" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><line id="actor10453" x1="275" y1="5" x2="275" y2="829" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g><defs><marker id="arrowhead" refX="5" refY="2" markerWidth="6" markerHeight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><g><rect x="0" y="75" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-4" y="99" fill="black" class="noteText"><tspan x="16" fill="black">showDisputeUI()</tspan></text></g><g><rect x="0" y="122" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-4" y="146" fill="black" class="noteText"><tspan x="16" fill="black">choose "court mode"</tspan></text></g><g><rect x="0" y="169" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="-4" y="193" fill="black" class="noteText"><tspan x="16" fill="black">onDisputeStart()</tspan></text><text x="-4" y="210" fill="black" class="noteText"><tspan x="16" fill="black">P1 may pause game here</tspan></text></g><g><rect x="200" y="233" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="196" y="257" fill="black" class="noteText"><tspan x="216" fill="black">onDisputeStart()</tspan></text><text x="196" y="274" fill="black" class="noteText"><tspan x="216" fill="black">P2 may pause game here</tspan></text></g><g><rect x="100" y="297" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="96" y="321" fill="black" class="noteText"><tspan x="116" fill="black">dispute process</tspan></text></g><g><rect x="0" y="344" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-4" y="368" fill="black" class="noteText"><tspan x="16" fill="black">onDisputeDone(addr)</tspan></text></g><g><rect x="0" y="391" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="-4" y="415" fill="black" class="noteText"><tspan x="16" fill="black">switch to on-chain</tspan></text><text x="-4" y="432" fill="black" class="noteText"><tspan x="16" fill="black"> play using addr</tspan></text></g><g><rect x="200" y="455" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="196" y="479" fill="black" class="noteText"><tspan x="216" fill="black">onDisputeDone(addr)</tspan></text></g><g><rect x="200" y="502" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="196" y="526" fill="black" class="noteText"><tspan x="216" fill="black">switch to on-chain</tspan></text><text x="196" y="543" fill="black" class="noteText"><tspan x="216" fill="black"> play using addr</tspan></text></g><g><rect x="0" y="566" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-4" y="590" fill="black" class="noteText"><tspan x="16" fill="black">on-chain play done</tspan></text></g><g><rect x="200" y="613" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="196" y="637" fill="black" class="noteText"><tspan x="216" fill="black">on-chain play done</tspan></text></g><g><rect x="0" y="660" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-4" y="684" fill="black" class="noteText"><tspan x="16" fill="black">resolve payment</tspan></text></g><g><rect x="200" y="707" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="196" y="731" fill="black" class="noteText"><tspan x="216" fill="black">resolve payment</tspan></text></g><g><rect x="0" y="764" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="796.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><rect x="200" y="764" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="796.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g></svg></div>
<h2 id="player-connectivity-handling-optional">Player Connectivity Handling (optional)</h2>
<p>We provide two optional FYI callbacks “onOpponentStatus(status)” and “onMyStatus(status)” for developers to customize game logic when player connectity status changes, where status could be “hasLostConnection”, “hasReconnected” and “hasLeftRoom”.</p>
<p>Example use cases of these callbacks are as follows:</p>
<p><strong>Use case 1: P1 temporarily lost connection and then reconnects successfully</strong></p>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-ClNRVYcjcpWIHL12" height="100%" width="100%" style="max-width:450px;" viewBox="-50 -10 450 511"><g></g><g><line id="actor10454" x1="75" y1="5" x2="75" y2="500" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><line id="actor10455" x1="275" y1="5" x2="275" y2="500" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g><defs><marker id="arrowhead" refX="5" refY="2" markerWidth="6" markerHeight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><g><rect x="0" y="75" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="-4" y="99" fill="black" class="noteText"><tspan x="16" fill="black">connection lost</tspan></text><text x="-4" y="116" fill="black" class="noteText"><tspan x="16" fill="black">trying to reconnect</tspan></text></g><g><rect x="200" y="139" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="196" y="163" fill="black" class="noteText"><tspan x="216" fill="black">onOpponentStatus(status)</tspan></text><text x="196" y="180" fill="black" class="noteText"><tspan x="216" fill="black">status=hasLostConnection</tspan></text></g><g><rect x="200" y="203" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="196" y="227" fill="black" class="noteText"><tspan x="216" fill="black">pause game</tspan></text><text x="196" y="244" fill="black" class="noteText"><tspan x="216" fill="black">wait for opponent</tspan></text></g><g><rect x="0" y="267" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="-4" y="291" fill="black" class="noteText"><tspan x="16" fill="black">reonnect successfully</tspan></text></g><g><rect x="200" y="314" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="196" y="338" fill="black" class="noteText"><tspan x="216" fill="black">onOpponentStatus(status)</tspan></text><text x="196" y="355" fill="black" class="noteText"><tspan x="216" fill="black">status=hasReconnected</tspan></text></g><g><rect x="200" y="378" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="196" y="402" fill="black" class="noteText"><tspan x="216" fill="black">continue game</tspan></text></g><g><rect x="0" y="435" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="467.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><rect x="200" y="435" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="467.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g></svg></div>
<p><strong>Use case 2: P1 lost connection and fails to reconnect to the room</strong></p>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-CiEE32aVLS7u2eRs" height="100%" width="100%" style="max-width:450px;" viewBox="-50 -10 450 528"><g></g><g><line id="actor10456" x1="75" y1="5" x2="75" y2="517" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><line id="actor10457" x1="275" y1="5" x2="275" y2="517" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g><defs><marker id="arrowhead" refX="5" refY="2" markerWidth="6" markerHeight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><g><rect x="0" y="75" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="-4" y="99" fill="black" class="noteText"><tspan x="16" fill="black">connection lost</tspan></text><text x="-4" y="116" fill="black" class="noteText"><tspan x="16" fill="black">trying to reconnect</tspan></text></g><g><rect x="200" y="139" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="196" y="163" fill="black" class="noteText"><tspan x="216" fill="black">onOpponentStatus(status)</tspan></text><text x="196" y="180" fill="black" class="noteText"><tspan x="216" fill="black">status=hasLostConnection</tspan></text></g><g><rect x="200" y="203" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="196" y="227" fill="black" class="noteText"><tspan x="216" fill="black">pause game</tspan></text><text x="196" y="244" fill="black" class="noteText"><tspan x="216" fill="black">wait for opponent</tspan></text></g><g><rect x="0" y="267" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="-4" y="291" fill="black" class="noteText"><tspan x="16" fill="black">fail to reconnect</tspan></text><text x="-4" y="308" fill="black" class="noteText"><tspan x="16" fill="black">P1 has left room</tspan></text></g><g><rect x="200" y="331" fill="#EDF2AE" stroke="#666" width="150" height="54" rx="0" ry="0" class="note"></rect><text x="196" y="355" fill="black" class="noteText"><tspan x="216" fill="black">onOpponentStatus(status)</tspan></text><text x="196" y="372" fill="black" class="noteText"><tspan x="216" fill="black">status=hasLeftRoom</tspan></text></g><g><rect x="200" y="395" fill="#EDF2AE" stroke="#666" width="150" height="37" rx="0" ry="0" class="note"></rect><text x="196" y="419" fill="black" class="noteText"><tspan x="216" fill="black">showDisputeUI()</tspan></text></g><g><rect x="0" y="452" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="484.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">P1</tspan></text></g><g><rect x="200" y="452" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="484.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">P2</tspan></text></g></svg></div>
</div>
</body>

</html>
